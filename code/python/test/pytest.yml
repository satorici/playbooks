settings:
  name: "pytest - unit test for Python"
  image: python

install:
  - python -m venv venv
  - venv/bin/pip install --upgrade pip setuptools wheel
  # Install all requirements files
  - find . -name "*requirements*.txt" -o -name "requirements*.txt" -o -path "*/requirements/*.txt" | xargs -I {} venv/bin/pip install -r {} || true
  # Install package in development mode
  - if [ -f "setup.py" ] || [ -f "pyproject.toml" ]; then venv/bin/pip install -e .[dev,test,testing] || venv/bin/pip install -e .; fi
  # Ensure pytest is available
  - venv/bin/pip install pytest pytest-xdist
  # Show what was actually installed for debugging
  - venv/bin/pip list
  
pytest:
  assertReturnCode: 0
  run:
    - ls -l; venv/bin/pytest -vv --disable-warnings
