settings:
  name: detect-secrets is an aptly named module for detecting secrets within a code base.

install:
  jq:
  - [ apt install -y jq ]
  detect-secrets:
  - [ pip3 install detect-secrets ]

detect-secrets:
  assertStdoutEqual: "{}\n"
  run:
  - [ "detect-secrets scan ./ --all-files | jq -r '.results | to_entries[] | .value[] | \"\\(.filename):\\(.line_number)\"' > output" ]
  output:
  - [ cat output ]
  print_lines:
  - [ "while read line; do file=$(echo \"$line\" | cut -d':' -f 1); line_num=$(echo \"$line\" | cut -d':' -f 2); echo File:$file, Line: $line_num:; sed -n \"${line_num}p\" $file; done < output" ]
