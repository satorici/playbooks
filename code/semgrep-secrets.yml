settings:
    name: Find Secrets using Semgrep
    description: A free open-source static code analysis tool with stable support for C#, Go, Java, JavaScript, JSON, Python, PHP, Ruby, and Scala. It has experimental support for nineteen other languages, as well as a language agnostic mode.
    mitigation: Remove secrets from your code
install:
    assertReturnCode: 0
    semgrep:
    - [ python3 -m pip install -q semgrep ]
semgrep:
    assertStdout: False
    secrets:
    - [ "semgrep --config 'p/secrets' --max-chars-per-line 1024 --exclude-rule generic.secrets.security.detected-twitter-oauth.detected-twitter-oauth --exclude-rule generic.secrets.security.detected-facebook-oauth.detected-facebook-oauth 2>>dev/null" ]

    # Opcion E:
    # assertStdout: False
    # secrets:
    # - value: [ semgrep --config "p/secrets" -q --max-chars-per-line 1024 ]
    # - weight|count: regexp("? Code Finding)[0]

    # Descartadas:
    # Opcion D:
    # Usamos una regexp sin ejecutar dentro del contenedor
    # secrets:
    #- [ semgrep --config "p/secrets" -q --max-chars-per-line 1024 --exclude-rule generic.secrets.security.detected-twitter-oauth.detected-twitter-oauth --exclude-rule generic.secrets.security.detected-facebook-oauth.detected-facebook-oauth ]
    # assertStdout: 
    #- value: False
    #- count: secrets.regexp("? Code Finding)[0]
    
    # Opcion A requiere multiples ejecuciones de comandos:
    #assertStdout: 
    #- value: False
    #- count: [ "semgrep --config 'p/secrets' -q --max-chars-per-line 1024 --exclude-rule generic.secrets.security.detected-twitter-oauth.detected-twitter-oauth --exclude-rule generic.secrets.security.detected-facebook-oauth.detected-facebook-oauth | grep "Code Finding" | awk '{print $2}'" ] ]

    # Opcion B requiere poder leer el output de una ejecucion previa:
    # ya tengo en secrets el output.. de secrets yo podria sacar el count
    #assertStdout: 
    #- value: False
    #- count: [ "echo $secrets  | grep "Code Finding" | awk '{print $2}'" ]

    # Opcion C requiere lenguaje publico o propio de satori
    # assertStdout: 
    #- value: False
    #- count: secrets.strip().split("\n")[2].split(" ")[2]
